\hypertarget{heap_8h_source}{}\doxysection{heap.\+h}
\label{heap_8h_source}\index{/home/maximillian/Desktop/MAMA/include/mem/heap.h@{/home/maximillian/Desktop/MAMA/include/mem/heap.h}}
\mbox{\hyperlink{heap_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef \_HEAP\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define \_HEAP\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{comment}{/* Kernel heap */}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#define TABLE\_SIZE 0x1000}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#define KHEAP\_BASE 0xD000000}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#define KHEAP\_MIN  0x10000}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#define KHEAP\_SIZE 0x1000000}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{comment}{/* Heap allocation header */}}
\DoxyCodeLine{11 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{12   \textcolor{keywordtype}{int} \mbox{\hyperlink{structheader_af8cc659f702446226bc2ebabba437d5d}{size}};}
\DoxyCodeLine{13   \textcolor{keywordtype}{int} \mbox{\hyperlink{structheader_aec42bcd6139d12f84d54b5e6a149b276}{index\_id}};}
\DoxyCodeLine{14 \} \mbox{\hyperlink{structheader}{header}};}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{17   \mbox{\hyperlink{structheader}{header}} \mbox{\hyperlink{structfooter_acae33dac61c9505ff5b850f88d32dd0b}{head}};}
\DoxyCodeLine{18 \} \mbox{\hyperlink{structfooter}{footer}};}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{21   \textcolor{keywordtype}{int} \mbox{\hyperlink{structindex__entry_a2b0247aae5c7f9884f8eef1ee121adb0}{size}};}
\DoxyCodeLine{22   \textcolor{keywordtype}{int} \mbox{\hyperlink{structindex__entry_afdbdffb4bd17e4ab003b94be3d5bade7}{empty}};}
\DoxyCodeLine{23   \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{structindex__entry_a0a8d4dc0595b5f2ef42e7080c5221c1f}{block}};}
\DoxyCodeLine{24 \} \mbox{\hyperlink{structindex__entry}{index\_entry}};}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{comment}{/* Kernel heap index table */}}
\DoxyCodeLine{27 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{28   \mbox{\hyperlink{structindex__entry}{index\_entry}} table[\mbox{\hyperlink{heap_8h_a032503e76d6f69bc67e99e909c8125da}{TABLE\_SIZE}}];}
\DoxyCodeLine{29   \textcolor{keywordtype}{int} \mbox{\hyperlink{structindex__table_a6e0e8e27a6a47e8ae2078b6fa447087f}{id}};}
\DoxyCodeLine{30 \} \mbox{\hyperlink{structindex__table}{index\_table}};}
\DoxyCodeLine{31 }
\DoxyCodeLine{32 \textcolor{comment}{/* Heap structure */}}
\DoxyCodeLine{33 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{34   \mbox{\hyperlink{structindex__table}{index\_table}} \mbox{\hyperlink{structheap_a8fe6ce2a8b45088990071e9b1d35add2}{index}};}
\DoxyCodeLine{35   \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{structheap_a744634662f1ffdb4d85632e68c063e51}{base}};}
\DoxyCodeLine{36   \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{structheap_ad2e0262828735d6e437facbfce37d6b0}{max\_size}};}
\DoxyCodeLine{37   \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{structheap_a7b4422774c5ca7ac8ed5ddfe95f5c8ec}{min\_size}};}
\DoxyCodeLine{38 \} \mbox{\hyperlink{structheap}{heap}};}
\DoxyCodeLine{39 }
\DoxyCodeLine{40 \textcolor{comment}{/*}}
\DoxyCodeLine{41 \textcolor{comment}{  Procedure..: \_kmalloc}}
\DoxyCodeLine{42 \textcolor{comment}{  Description..: Base-\/level kernel memory allocation routine. Used to}}
\DoxyCodeLine{43 \textcolor{comment}{      provide page alignment and access physical addresses of allocations.}}
\DoxyCodeLine{44 \textcolor{comment}{      Called by kmalloc with align=0, physical\_address=0.}}
\DoxyCodeLine{45 \textcolor{comment}{*/}}
\DoxyCodeLine{46 \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}{\_kmalloc}}(\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} size, \textcolor{keywordtype}{int} align, \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} *phys\_addr);}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{comment}{/*}}
\DoxyCodeLine{49 \textcolor{comment}{  Procedure..: kmalloc}}
\DoxyCodeLine{50 \textcolor{comment}{  Description..: Standard kernel memory allocation rountine. Use this unless you}}
\DoxyCodeLine{51 \textcolor{comment}{      need to specify alignment or obtain a physical address. Calls \_kmalloc.}}
\DoxyCodeLine{52 \textcolor{comment}{*/}}
\DoxyCodeLine{53 \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}{kmalloc}}(\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} size);}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{comment}{/*}}
\DoxyCodeLine{56 \textcolor{comment}{  Procedure..: kfree}}
\DoxyCodeLine{57 \textcolor{comment}{  Description..: Free kernel memory.}}
\DoxyCodeLine{58 \textcolor{comment}{*/}}
\DoxyCodeLine{59 \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}{kfree}}();}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{comment}{/*}}
\DoxyCodeLine{62 \textcolor{comment}{  Procedure..: init\_kheap}}
\DoxyCodeLine{63 \textcolor{comment}{  Description..: Initialize the kernel heap, and set it as the current heap.}}
\DoxyCodeLine{64 \textcolor{comment}{*/}}
\DoxyCodeLine{65 \textcolor{keywordtype}{void} \mbox{\hyperlink{heap_8h_a755a69ff831b6e23a808dcf4b9944854}{init\_kheap}}();}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 \textcolor{comment}{/*}}
\DoxyCodeLine{68 \textcolor{comment}{  Procedure..: alloc}}
\DoxyCodeLine{69 \textcolor{comment}{  Description..: Allocate some memory using the given heap. Can specify page-\/alignment.}}
\DoxyCodeLine{70 \textcolor{comment}{*/}}
\DoxyCodeLine{71 \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}{alloc}}(\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} size, \mbox{\hyperlink{structheap}{heap}} *hp, \textcolor{keywordtype}{int} align);}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{comment}{/*}}
\DoxyCodeLine{74 \textcolor{comment}{  Procedure..: make\_heap}}
\DoxyCodeLine{75 \textcolor{comment}{  Description..: Create a new heap.}}
\DoxyCodeLine{76 \textcolor{comment}{  Parameters..: base -\/ physical start address of the heap}}
\DoxyCodeLine{77 \textcolor{comment}{                max  -\/ maximum size the heap may grow to}}
\DoxyCodeLine{78 \textcolor{comment}{        min  -\/ minimum/initial size}}
\DoxyCodeLine{79 \textcolor{comment}{*/}}
\DoxyCodeLine{80 \mbox{\hyperlink{structheap}{heap}}* \mbox{\hyperlink{heap_8h_abf10fb79c17a354e68c11652bc5f9d0c}{make\_heap}}(\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}}, \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} max, \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} min);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
